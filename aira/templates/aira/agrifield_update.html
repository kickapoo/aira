{% extends 'base.html' %}
{% load bootstrap3 %}
{% block title %} {{ user }} {% endblock %}

{% block content %}
<div class="row">
  <div class="col-lg-12">
    <div class="panel panel-default">
      <div class="panel-heading">
        <h4>{% trans "Update" %}{{ object.name }}</h4>
      </div>
       <div class="panel panel-body">
        <div class="col-md-6">
            <div id="on_clink_map" class="map"></div>
            <script>
                map = new OpenLayers.Map('on_clink_map',
                      {units: 'm',
                       displayProjection: 'EPSG:4326',
                       controls: [new OpenLayers.Control.LayerSwitcher(),
                                  new OpenLayers.Control.Zoom(),
                                  new OpenLayers.Control.Navigation(),
                                  new OpenLayers.Control.MousePosition(),
                                  new OpenLayers.Control.ScaleLine()]
                       });
                // Open Cycle
                var cycle = new OpenLayers.Layer.OSM.CycleMap(
                          "Open Cycle Map",
                          {isBaseLayer: true,
                           projection: 'EPSG:3857'});

                map.addLayer(cycle);
                var ktimatologio = new OpenLayers.Layer.WMS("Hellenic Cadastre",
                         "http://gis.ktimanet.gr/wms/wmsopen/wmsserver.aspx",
                           {   layers: 'KTBASEMAP', transparent: false},
                           {   isBaseLayer: true,
                               projection: new OpenLayers.Projection("EPSG:900913"),
                               iformat: 'image/png'});
                map.addLayer(ktimatologio);
                var fieldloc = new OpenLayers.LonLat({{ object.longitude }}, {{ object.latitude }}).transform('EPSG:4326', 'EPSG:3857');
                var marker = new OpenLayers.Marker(fieldloc)
                var markers = new OpenLayers.Layer.Markers( "{{ object.name }}" );
                map.addLayer(markers);
                markers.addMarker(marker);
                map.setCenter(fieldloc, 10);
                map.events.register("click", map , function(e){
                            var opx = map.getLonLatFromPixel(e.xy) ;
                            var marker = new OpenLayers.Marker(opx);
                            markers.clearMarkers();
                            markers.addMarker(marker);
                            var lonlat = map.getLonLatFromPixel(e.xy).transform('EPSG:3857', 'EPSG:4326');
                              document.getElementById("id_latitude").value = lonlat.lat.toFixed(5);
                              document.getElementById("id_longitude").value = lonlat.lon.toFixed(5);
                });
              </script>
              <sub> {% trans "Click on Map to add your Field coordinates" %}</sub>
        </div>
        <div class="col-md-6">
          <form method="post" role="form">
            {% csrf_token %}
            {% bootstrap_form form %}
            {% buttons %}
              <button type="submit" class="btn btn-success btn-xs">{% trans "Submit" %}</button>
              <a class="btn btn-success btn-xs" href="{% url 'home' %}"> {% trans "Back" %} </a>
            {% endbuttons %}
          </form>
        </div>
    </div>
  </div>
</div>
{% endblock %}
